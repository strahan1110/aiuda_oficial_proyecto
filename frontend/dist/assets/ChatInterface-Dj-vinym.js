import{c as v,r as x,s as g,j as e}from"./index-hWt4zH_6.js";import{B as _,S as A}from"./send-DIZnnjUg.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=v("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=v("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=v("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=v("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=v("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),L=()=>{const[i,f]=x.useState(null);return x.useEffect(()=>{(async()=>{const{data:{user:u}}=await g.auth.getUser();f(u)})();const{data:{subscription:m}}=g.auth.onAuthStateChange((u,d)=>{f((d==null?void 0:d.user)||null)});return()=>m.unsubscribe()},[]),{user:i}};function q(){const[i,f]=x.useState([]),[l,m]=x.useState([]),[u,d]=x.useState(!1),{user:a}=L(),o=async()=>{if(a){d(!0);try{const{data:r,error:s}=await g.from("chats").select("*").eq("user_id",a.id).order("updated_at",{ascending:!1});if(s)throw s;f(r||[])}catch(r){console.error("Error loading chats:",r)}finally{d(!1)}}},n=async r=>{if(!a)return null;try{const{data:s,error:c}=await g.from("chats").insert({user_id:a.id,title:r||`Chat ${new Date().toLocaleDateString()}`,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(c)throw c;return await o(),s}catch(s){return console.error("Error creating chat:",s),null}},h=async r=>{if(a){d(!0);try{const{data:s,error:c}=await g.from("messages").select("*").eq("chat_id",r).eq("user_id",a.id).order("created_at",{ascending:!0});if(c)throw c;m(s||[])}catch(s){console.error("Error loading messages:",s)}finally{d(!1)}}},N=async(r,s,c)=>{if(a)try{const{data:y,error:j}=await g.from("messages").insert({chat_id:r,user_id:a.id,content:s,role:c,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(j)throw j;const{error:t}=await g.from("chats").update({last_message:s.substring(0,100)+(s.length>100?"...":""),updated_at:new Date().toISOString()}).eq("id",r);if(t)throw t;m(p=>[...p,y]),await o()}catch(y){console.error("Error adding message:",y)}},S=async r=>{if(a)try{await g.from("messages").delete().eq("chat_id",r).eq("user_id",a.id);const{error:s}=await g.from("chats").delete().eq("id",r).eq("user_id",a.id);if(s)throw s;await o(),m([])}catch(s){console.error("Error deleting chat:",s)}},C=r=>r.trim().split(" ").slice(0,6).join(" ")+(r.split(" ").length>6?"...":""),k=async(r,s)=>{if(a)try{const{error:c}=await g.from("chats").update({title:s}).eq("id",r).eq("user_id",a.id);if(c)throw c;await o()}catch(c){console.error("Error updating chat title:",c)}};return x.useEffect(()=>{a&&o()},[a]),{chats:i,currentMessages:l,loading:u,loadChats:o,createChat:n,loadMessages:h,addMessage:N,deleteChat:S,generateChatTitle:C,updateChatTitle:k}}function O({onSelectChat:i,currentChatId:f}){const{chats:l,loading:m,createChat:u,deleteChat:d}=q(),a=async()=>{const n=await u();n&&i(n.id)},o=async(n,h)=>{h.stopPropagation(),confirm("¿Estás seguro de eliminar esta conversación?")&&await d(n)};return m?e.jsx("div",{className:"w-64 bg-gray-50 border-r h-full p-4",children:e.jsx("div",{className:"animate-pulse space-y-2",children:[...Array(3)].map((n,h)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},h))})}):e.jsxs("div",{className:"w-64 bg-gray-50 border-r h-full flex flex-col",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("button",{onClick:a,className:"w-full flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(z,{size:16}),"Nuevo Chat"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:l.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-8",children:[e.jsx(T,{className:"mx-auto mb-2",size:32}),e.jsx("p",{className:"text-sm",children:"No hay conversaciones"}),e.jsx("p",{className:"text-xs mt-1",children:"Inicia un nuevo chat"})]}):l.map(n=>e.jsx("div",{onClick:()=>i(n.id),className:`p-3 rounded-lg cursor-pointer mb-2 group transition-colors border ${f===n.id?"bg-blue-100 border-blue-300 shadow-sm":"bg-white hover:bg-gray-100 border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-sm truncate text-gray-900",children:n.title}),n.last_message&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-1",children:n.last_message}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(n.updated_at).toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("button",{onClick:h=>o(n.id,h),className:"opacity-0 group-hover:opacity-100 p-1 text-red-500 hover:bg-red-100 rounded transition-all ml-2",title:"Eliminar conversación",children:e.jsx($,{size:14})})]})},n.id))}),e.jsx("div",{className:"p-4 border-t bg-gray-100",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:[l.length," conversación",l.length!==1?"es":""]})})]})}function V(){const[i,f]=x.useState(null),[l,m]=x.useState(""),[u,d]=x.useState(!1),a=x.useRef(null),{currentMessages:o,loadMessages:n,addMessage:h,createChat:N,generateChatTitle:S,updateChatTitle:C}=q(),k=()=>{var t;(t=a.current)==null||t.scrollIntoView({behavior:"smooth"})};x.useEffect(()=>{k()},[o]);const r=async(t,p)=>{var w,M;try{console.log("Enviando mensaje a Stack AI:",t);const b=await fetch("https://api.stack-ai.com/inference/v0/run/94a5e0b3-19ec-46ac-aacf-ebd75e05160b/68201e92810c4652c92fd764",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer 570fc2dd-8dcd-4205-927e-b405a48a5db7",Accept:"application/json"},body:JSON.stringify({"in-1":t})});if(console.log("Respuesta de Stack AI - Estado:",b.status),!b.ok){const D=await b.text();throw console.error("Error en la respuesta de Stack AI:",D),new Error(`Error ${b.status}: ${D}`)}const E=await b.json();return console.log("Respuesta completa de Stack AI:",E),((w=E.outputs)==null?void 0:w["out-0"])||((M=E.outputs)==null?void 0:M["out-1"])||"Lo siento, no pude procesar tu consulta."||"No se pudo obtener una respuesta válida."}catch(I){return console.error("Error llamando a Stack AI:",I),"Lo siento, hubo un error al procesar tu consulta médica. Por favor intenta nuevamente más tarde."}},s=async()=>{if(!l.trim()||!i||u)return;d(!0);const t=l.trim();m("");try{if(await h(i,t,"user"),o.length===0){const w=S(t);await C(i,w)}const p=await r(t,o);await h(i,p,"assistant")}catch(p){console.error("Error sending message:",p),await h(i,"Hubo un error al procesar tu mensaje. Por favor intenta nuevamente.","assistant")}finally{d(!1)}},c=async t=>{f(t),await n(t)},y=async()=>{const t=await N("Nueva consulta médica");t&&(f(t.id),await n(t.id))},j=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),s())};return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(O,{onSelectChat:c,currentChatId:i||void 0}),e.jsxs("div",{className:"flex-1 flex flex-col bg-white",children:[e.jsx("div",{className:"border-b bg-white px-6 py-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Asistente Médico UTP"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tu consulta médica personalizada"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:i?e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[o.length===0&&!u&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-blue-50 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:e.jsx(_,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"¡Hola! Soy tu asistente médico"}),e.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"Puedes hacerme preguntas sobre síntomas, medicamentos, o cualquier consulta médica. Estoy aquí para ayudarte."})]}),o.map(t=>e.jsxs("div",{className:`flex gap-4 ${t.role==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${t.role==="user"?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:t.role==="user"?e.jsx(H,{size:16}):e.jsx(_,{size:16})}),e.jsxs("div",{className:`flex-1 max-w-3xl ${t.role==="user"?"text-right":"text-left"}`,children:[e.jsx("div",{className:`inline-block px-4 py-3 rounded-2xl ${t.role==="user"?"bg-blue-600 text-white rounded-br-sm":"bg-gray-100 text-gray-900 rounded-bl-sm"}`,children:e.jsx("div",{className:"whitespace-pre-wrap",children:t.content})}),e.jsx("div",{className:`text-xs text-gray-500 mt-1 ${t.role==="user"?"text-right":"text-left"}`,children:new Date(t.created_at).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})]},t.id)),u&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center",children:e.jsx(_,{size:16})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"inline-block px-4 py-3 bg-gray-100 rounded-2xl rounded-bl-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Analizando tu consulta..."})]})})})]}),e.jsx("div",{ref:a})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"p-6 bg-blue-50 rounded-full w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx(T,{className:"w-12 h-12 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Selecciona o crea una conversación"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Elige una conversación existente o inicia una nueva consulta médica"}),e.jsx("button",{onClick:y,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Iniciar Nueva Consulta"})]})})}),i&&e.jsx("div",{className:"border-t bg-white px-6 py-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex gap-3 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:l,onChange:t=>m(t.target.value),onKeyPress:j,placeholder:"Describe tus síntomas o haz tu consulta médica...",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:1,style:{minHeight:"48px",maxHeight:"120px"},disabled:u})}),e.jsx("button",{onClick:s,disabled:u||!l.trim(),className:"p-3 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-shrink-0",title:"Enviar mensaje",children:e.jsx(A,{size:20})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:"Presiona Enter para enviar, Shift+Enter para nueva línea"}),e.jsxs("span",{className:l.length>500?"text-red-500":"",children:[l.length,"/1000"]})]})]})})]})]})}export{V as default};
